<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>جستجوی کتاب‌های خطی فارسی</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script type="text/javascript">
    const { useState, useEffect } = React;

    const App = () => {
      const [books, setBooks] = useState([]);
      const [searchTerm, setSearchTerm] = useState('');
      const [filteredBooks, setFilteredBooks] = useState([]);
      const [selectedType, setSelectedType] = useState('همه');
      const [selectedDb, setSelectedDb] = useState('همه');
      const [types, setTypes] = useState([]);
      const [dbs, setDbs] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const fetchData = async () => {
          setLoading(true);
          try {
            const response = await fetch('./utlibrary-manuscripts.json');
            const data = await response.json();
            setBooks(data);

            const uniqueTypes = [...new Set(data.map(book => book.type))].sort();
            const uniqueDbs = [...new Set(data.map(book => book.db))].sort();
            setTypes(['همه', ...uniqueTypes]);
            setDbs(['همه', ...uniqueDbs]);
          } catch (error) {
            console.error('خطا در بارگذاری داده‌ها:', error);
          } finally {
            setLoading(false);
          }
        };

        fetchData();
      }, []);

      useEffect(() => {
        let result = [...books];

        const q = searchTerm.toLowerCase().trim();
        if (q) {
          result = result.filter(book =>
            (book.title || '').toLowerCase().includes(q)
          );
        }

        if (selectedType !== 'همه') {
          result = result.filter(book => book.type === selectedType);
        }

        if (selectedDb !== 'همه') {
          result = result.filter(book => book.db === selectedDb);
        }

        setFilteredBooks(result.slice(0, 200));
      }, [searchTerm, selectedType, selectedDb, books]);

      return React.createElement(
        'div',
        { className: 'p-6 max-w-5xl mx-auto', dir: 'rtl' },
        React.createElement('h1', { className: 'text-3xl font-bold mb-6 text-center text-gray-800' }, 'جستجوی کتاب‌های خطی فارسی'),
        React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow mb-6' },
          React.createElement('input', {
            type: 'text',
            className: 'w-full mb-4 p-3 border rounded text-lg',
            placeholder: 'جستجو بر اساس عنوان...',
            value: searchTerm,
            onChange: e => setSearchTerm(e.target.value),
            dir: 'rtl'
          }),
          React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
            React.createElement('div', null,
              React.createElement('label', { className: 'block mb-1 text-gray-700 font-medium' }, 'نوع:'),
              React.createElement('select', {
                className: 'w-full p-2 border rounded',
                value: selectedType,
                onChange: e => setSelectedType(e.target.value)
              }, types.map(type => React.createElement('option', { key: type, value: type }, type)))
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block mb-1 text-gray-700 font-medium' }, 'مرکز:'),
              React.createElement('select', {
                className: 'w-full p-2 border rounded',
                value: selectedDb,
                onChange: e => setSelectedDb(e.target.value)
              }, dbs.map(db => React.createElement('option', { key: db, value: db }, db)))
            )
          )
        ),
        loading
          ? React.createElement('div', { className: 'text-center text-gray-600 text-lg' }, 'در حال بارگذاری...')
          : React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
              filteredBooks.length > 0
                ? filteredBooks.map((book, index) =>
                  React.createElement('div', {
                    key: book.id || index,
                    className: 'bg-white p-4 rounded-lg shadow border'
                  },
                    React.createElement('h2', { className: 'font-bold text-blue-700 mb-2 text-xl' }, book.title),
                    React.createElement('p', { className: 'text-gray-800 mb-1' }, 'پدیدآور: ' + (book.author || '')),
                    React.createElement('p', { className: 'text-gray-800 mb-1' }, 'مرکز: ' + (book.db || '')),
                    React.createElement('p', { className: 'text-gray-800 mb-1' }, 'نوع: ' + (book.type || '')),
                    React.createElement('p', { className: 'text-gray-800 mb-1' }, 'شماره راهنما: ' + (book.id || '')),
                    book.catid && React.createElement('a', {
                      href: `https://lib.ut.ac.ir/site/catalogue/${book.catid}`,
                      className: 'text-blue-600 hover:underline',
                      target: '_blank',
                      rel: 'noopener noreferrer'
                    }, 'نمایش در کاتالوگ')
                  )
                )
                : React.createElement('div', { className: 'col-span-full text-center text-gray-600 text-xl p-8' }, 'نتیجه‌ای یافت نشد.')
            )
      );
    };

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(App));
  </script>
</body>
</html>
