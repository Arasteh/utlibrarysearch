<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>جستجوی کتاب‌های خطی فارسی</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script type="text/javascript">
    const { useState, useEffect } = React;

    const App = () => {
      const [books, setBooks] = useState([]);
      const [searchTerm, setSearchTerm] = useState('');
      const [filteredBooks, setFilteredBooks] = useState([]);
      const [selectedType, setSelectedType] = useState('همه');
      const [selectedDb, setSelectedDb] = useState('همه');
      const [types, setTypes] = useState([]);
      const [dbs, setDbs] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const fetchData = async () => {
          setLoading(true);
          try {
            const response = await fetch('./utlibrary-manuscripts.json');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            setBooks(data);
            setTypes(['همه', ...[...new Set(data.map(book => book.type))].sort()]);
            setDbs(['همه', ...[...new Set(data.map(book => book.db))].sort()]);
          } catch (error) {
            console.error("خطا در بارگذاری داده‌ها:", error);
          } finally {
            setLoading(false);
          }
        };
        fetchData();
      }, []);

      useEffect(() => {
        let currentFiltered = books;

        if (searchTerm.trim().length === 0) {
          const shuffled = [...books].sort(() => 0.5 - Math.random());
          setFilteredBooks(shuffled.slice(0, 100));
          return;
        }

        if (searchTerm.trim().length >= 2) {
          const lower = searchTerm.toLowerCase();
          currentFiltered = currentFiltered.filter(book =>
            (book.title && book.title.toLowerCase().includes(lower)) ||
            (book.author && book.author.toLowerCase().includes(lower)) ||
            (book.id && book.id.toLowerCase().includes(lower))
          );
        }

        if (selectedType !== 'همه') {
          currentFiltered = currentFiltered.filter(book => book.type === selectedType);
        }

        if (selectedDb !== 'همه') {
          currentFiltered = currentFiltered.filter(book => book.db === selectedDb);
        }

        setFilteredBooks(currentFiltered);
      }, [books, searchTerm, selectedType, selectedDb]);

      return React.createElement(
        'div',
        { className: 'min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8', dir: 'rtl' },
        React.createElement('header', { className: 'text-center mb-8' },
          React.createElement('h1', { className: 'text-3xl sm:text-4xl font-bold text-gray-800 mb-2' }, 'جستجوی کتاب‌های خطی فارسی'),
          React.createElement('p', { className: 'text-gray-600 text-lg' }, 'ابزاری ساده برای کاوش در مجموعه کتاب‌های خطی')
        ),
        React.createElement('div', { className: 'max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md mb-8' },
          React.createElement('div', { className: 'mb-4' },
            React.createElement('label', { htmlFor: 'search', className: 'block text-gray-700 text-sm font-bold mb-2' }, 'جستجو (حداقل ۲ حرف):'),
            React.createElement('input', {
              type: 'text',
              id: 'search',
              className: 'shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg',
              placeholder: 'جستجو بر اساس عنوان، نویسنده یا شناسه...',
              value: searchTerm,
              onChange: e => setSearchTerm(e.target.value),
              dir: 'rtl'
            })
          ),
          React.createElement('div', { className: 'grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4' },
            React.createElement('div', null,
              React.createElement('label', { htmlFor: 'type-filter', className: 'block text-gray-700 text-sm font-bold mb-2' }, 'فیلتر بر اساس نوع:'),
              React.createElement('select', {
                id: 'type-filter',
                className: 'shadow border rounded-lg w-full py-3 px-4 text-gray-700 text-lg bg-white focus:ring-2 focus:ring-blue-500',
                value: selectedType,
                onChange: e => setSelectedType(e.target.value),
                dir: 'rtl'
              }, types.map(type => React.createElement('option', { key: type, value: type }, type)))
            ),
            React.createElement('div', null,
              React.createElement('label', { htmlFor: 'db-filter', className: 'block text-gray-700 text-sm font-bold mb-2' }, 'فیلتر بر اساس پایگاه داده:'),
              React.createElement('select', {
                id: 'db-filter',
                className: 'shadow border rounded-lg w-full py-3 px-4 text-gray-700 text-lg bg-white focus:ring-2 focus:ring-blue-500',
                value: selectedDb,
                onChange: e => setSelectedDb(e.target.value),
                dir: 'rtl'
              }, dbs.map(db => React.createElement('option', { key: db, value: db }, db)))
            )
          )
        ),
        loading
          ? React.createElement('div', { className: 'text-center text-gray-600 text-xl' }, 'در حال بارگذاری داده‌ها...')
          : React.createElement('div', { className: 'max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6' },
            filteredBooks.length > 0
              ? filteredBooks.map((book, index) => React.createElement('div', {
                key: book.id || index,
                className: 'bg-white p-6 rounded-lg shadow-md border hover:shadow-lg transition-shadow'
              },
                React.createElement('h2', { className: 'text-xl font-bold text-blue-800 mb-1' }, book.title),
                React.createElement('p', { className: 'text-gray-800 mb-1' },
                  React.createElement('span', { className: 'font-medium' }, 'پدیدآور: '), book.author || '—'
                ),
                React.createElement('p', { className: 'text-gray-800 mb-1' },
                  React.createElement('span', { className: 'font-medium' }, 'تاریخ انتشار: '), book.date || '—',
                  React.createElement('span', { className: 'font-medium mr-2' }, ' | شماره راهنما: '), book.id
                ),
                React.createElement('p', { className: 'text-gray-800 mb-1' },
                  React.createElement('span', { className: 'font-medium' }, 'مرکز: '), book.db
                ),
                React.createElement('p', { className: 'text-gray-800 mb-1' },
                  React.createElement('span', { className: 'font-medium' }, 'نوع: '), book.type
                ),
                book.catid && React.createElement('p', { className: 'text-gray-800' },
                  React.createElement('span', { className: 'font-medium' }, 'لینک کاتالوگ: '),
                  React.createElement('a', {
                    href: `https://lib.ut.ac.ir/site/catalogue/${book.catid}`,
                    target: '_blank',
                    rel: 'noopener noreferrer',
                    className: 'text-blue-600 hover:underline'
                  }, book.catid)
                )
              ))
              : React.createElement('div', { className: 'col-span-full text-center text-gray-600 text-xl p-8' }, 'هیچ نتیجه‌ای یافت نشد.')
          )
      );
    };

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(App));
  </script>
</body>
</html>
